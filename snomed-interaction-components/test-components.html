<!DOCTYPE html>
<html>
    <head>
        <title>IHTSDO SNOMED CT Browser - beta</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width">
		<meta name="description" content="IHTSDO SNOMED CT Browser">
		<meta name="author" content="IHTSDO">
		<link rel="icon" type="image/png"  href="favicon.ico">

        <script type="text/javascript" src="external-libs/handlebars-v1.3.0.js"></script>
        <script src="external-libs/base64.js" type="text/javascript"></script>
        <link rel="stylesheet" href="external-css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/jquery.splitter.css">
        <link rel="stylesheet" href="external-css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="external-css/bootstrap.min.base.12.css">
        <link rel="stylesheet" href="css/popover-extra-placements.css">
        <link rel="stylesheet" href="css/drag-drop.css">
        <link rel="stylesheet" href="css/sct-widgets.css">
        <link rel="stylesheet" href="css/sct-diagram.css">
        <link rel="stylesheet" href="css/flags.css">
        <link rel="stylesheet" href="css/jquery.splitter.css">
        <link rel="stylesheet" href="css/popover.css">
        <link rel="stylesheet" href="external-css/animate.css">

        <script src="external-libs/jquery-2.1.0.min.js" type="text/javascript"></script>
        <script src="external-libs/jquery.svg.js" type="text/javascript"></script>
        <script src="external-libs/lodash.js"></script>
        <script src="external-libs/conduit.min.js"></script>
        <script src="external-libs/postal.min.js"></script>
        <script src="external-libs/notify.js"></script>
        <script src="external-libs/excellentexport.min.js"></script>
        <script src="external-libs/handlebars-v1.3.0.js" type="text/javascript"></script>
        <script src="external-libs/base64.js" type="text/javascript"></script>
        <script src="external-libs/bootstrap.min.js" type="text/javascript"></script>
        <script src="external-libs/jquery.i18n.properties-min-1.0.9.js"></script>
        <script src="external-libs/ZeroClipboard.js" type="text/javascript"></script>
        <script src="external-libs/jquery.history.js"></script>
        <script src="external-libs/bootstrap-switch.min.js" type="text/javascript"></script>
        <script src="external-libs/clipboard.min.js"></script>

        <script src="views/compiled/templates.js" type="text/javascript"></script>

        <script src="js/util.js" type="text/javascript"></script>
        <script src="js/jquery.splitter-0.14.0.js" type="text/javascript"></script>
        <script src="js/countryIcons.js" type="text/javascript"></script>
        <script src="js/svgdiagrammingv2.js" type="text/javascript"></script>
        <script src="js/drawConceptDiagram.js" type="text/javascript"></script>
        <script src="js/searchPlugin.js" type="text/javascript"></script>
        <script src="js/taxonomyPlugin.js" type="text/javascript"></script>
        <script src="js/favoritesPlugin.js" type="text/javascript"></script>
        <script src="js/queryPlugin.js" type="text/javascript"></script>
        <script src="js/refsetPlugin.js" type="text/javascript"></script>
        <script src="js/conceptExpressions.js" type="text/javascript"></script>
        <script src="js/conceptDetailsPlugin.js" type="text/javascript"></script>
        <script src="js/popover-extra-placements.js" type="text/javascript"></script>
        <script src="js/popover.js"></script>

        <script type="text/javascript">
            var selectedLanguage = 'en_US';
            var selectedFlag = 'img/flags/us.png';
            var currentPerspective = "home";

            var options = {
//                serverUrl: "http://107.170.67.17/api/snomed",
//                serverUrl: "http://107.170.43.89/api/snomed",
//                serverUrl: "http://162.243.35.127/api/snomed",
                //serverUrl: "https://browser-aws-1.ihtsdotools.org/api/snomed",
                // serverUrl: "https://dailybuild.ihtsdotools.org/api/snomed",
                serverUrl: "https://prod-dailybuild.ihtsdotools.org/api/snomed",
                edition: "en-edition",
                release: "v20180131",
                showIds: false,
                hideNotAcceptable: true,
                displayInactiveDescriptions: false,
                displaySynonyms: true,
                selectedView: "inferred",
                displayChildren: false,
                langRefset: ["900000000000509007","20581000087109"],
                diagrammingMarkupEnabled: false
            };

            var manifests = [];
            function loadReleasesButtons(){
                var buttonsHtml = "";
                $.each(manifests, function(i, field){
                    buttonsHtml += '<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease(\'' + field.resourceSetName + " " + field.effectiveTime + '\', \'' + field.databaseName + '\', \'v' + field.collectionName + '\', \'' + field.defaultTermLangRefset + '\', false, \'' + field._id + '\');switchLanguage(\'' + field.defaultTermLangCode + '\', \'img/flags/us.png\', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/' + field.databaseName.substr(0, 2) + '.png">&nbsp;&nbsp;&nbsp;Start browsing...</span><br><span class="small">' + field.resourceSetName + " " + field.effectiveTime + '</span></a>&nbsp;&nbsp;';
                });
                $("#releasesButtons").html(buttonsHtml);
            }

//            xhr = $.getJSON("http://107.170.143.181/api/snomed".replace("snomed", "") + "server/releases", function (result) {
//                // nothing
//            }).done(function (result) {
//                $.each(result, function (i, field){
//                    manifests.push(field);
//                });
////                console.log(manifests);
//            });
//
//            xhr = $.getJSON("http://107.170.98.11/api/server/releases", function (result){
//
//            }).done(function (result) {
//                $.each(result, function (i, field){
//                    manifests.push(field);
//                });
////                console.log(manifests);
//            });

            var QueryString = function () {
                var query_string = {};
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if (typeof query_string[pair[0]] === "undefined") {
                        query_string[pair[0]] = pair[1];
                    } else if (typeof query_string[pair[0]] === "string") {
                        var arr = [ query_string[pair[0]], pair[1] ];
                        query_string[pair[0]] = arr;
                    } else {
                        query_string[pair[0]].push(pair[1]);
                    }
                }
                return query_string;
            } ();

            function start() {

//                client = new ZeroClipboard($("#mainDiv"));
                // Read parameters
                if (typeof QueryString.dev != "undefined") {
                    console.log("Using Dev Server...");
//                    options.serverUrl = "http://107.170.33.116/api";
//                    options.serverUrl = "http://162.243.35.127/api/snomed";
                }
                var edition = QueryString.edition;
                if (typeof edition == "undefined" || edition == null || edition == "") {
                    edition = options.edition;
                }
                options.edition = edition;

                var release = QueryString.release;
                if (typeof release == "undefined" || release == null || release == "") {
                    release = options.release;
                }
                options.release = release;

                var diagrammingMarkupEnabled = QueryString.diagrammingMarkupEnabled;
                if (typeof diagrammingMarkupEnabled == "undefined" || diagrammingMarkupEnabled == null || diagrammingMarkupEnabled == "") {
                    diagrammingMarkupEnabled = false;
                }
                options.diagrammingMarkupEnabled = diagrammingMarkupEnabled;

                if (QueryString.langRefset) {
                    var langRefset = QueryString.langRefset.split(",");
                    if (typeof langRefset == "undefined" || langRefset == null || langRefset == "") {
                        langRefset = options.langRefset;
                    }
                    options.langRefset = langRefset;
                }

                $("#editionLabel").html(edition + " " + release);

                if (QueryString.ui_language == "en") {
                    selectedLanguage = 'en_US';
                    selectedFlag = 'img/flags/us.png';
                } else if (QueryString.ui_language == "es") {
                    selectedLanguage = 'es';
                    selectedFlag = 'img/flags/es.png';
                }  else if (QueryString.ui_language == "da") {
                    selectedLanguage = 'da';
                    selectedFlag = 'img/flags/dk.png';
                }

                switchLanguage(selectedLanguage, selectedFlag, false);

                var cdValue1 = QueryString.conceptId1;
                if (typeof cdValue1 == "undefined" || cdValue1 == null || cdValue1 == "") {
                    cdValue1 = 404684003;
                }

                var cdValue2 = QueryString.conceptId2;
                if (typeof cdValue2 == "undefined" || cdValue2 == null || cdValue2 == "") {
                    cdValue2 = 404684003;
                }

                var txValue1 = QueryString.conceptIdTx1;
                if (typeof txValue1 == "undefined" || txValue1 == null || txValue1 == "") {
                    txValue1 = 138875005;
                }

                var txValue2 = QueryString.conceptIdTx2;
                if (typeof txValue2 == "undefined" || txValue2 == null || txValue2 == "") {
                    txValue2 = 138875005;
                }

                var acceptLicense = QueryString.acceptLicense;
                if (typeof acceptLicense == "undefined" || acceptLicense == null || acceptLicense == "") {
                    acceptLicense = false;
                }
                options.acceptLicense = (acceptLicense == "true");

                xhr = $.getJSON(options.serverUrl.replace("snomed", "") + "server/releases", function (result) {
                    // nothing
                }).done(function (result) {
                    $.each(result, function (i, field){
                        manifests.push(field);
                        if (field.databaseName == options.edition) {
                            options.manifest = field;
                        }
                    });
                    loadReleasesButtons();
                    if (QueryString.perspective == "home") {
                        initialize();
                    } else if (QueryString.perspective == "browsing") {
                        currentPerspective = "browsing";
                        switchToBrowsing(cdValue1,cdValue2,txValue1);
                    } else if (QueryString.perspective == "full") {
                        currentPerspective = "full";
                        switchToFullHeight(cdValue1,txValue1);
                    } else if (QueryString.perspective == "compare_concepts") {
                        currentPerspective = "compare_concepts";
                        switchToComparingConcepts(cdValue1,cdValue2);
                    } else if (QueryString.perspective == "compare_hierarchies") {
                        currentPerspective = "compare_hierarchies";
                        switchToComparingTaxonomies(cdValue1,txValue1,txValue2);
                    } else if (QueryString.perspective == "responsive") {
                        currentPerspective = "responsive";
                        switchToResponsiveLayout(cdValue1,cdValue2,txValue1);
                    } else if (QueryString.perspective == "GMDN") {
                        currentPerspective = "GMDN";
                        switchToGMDN(cdValue1, txValue1, txValue2);
                    } else {
                        initialize();
                    }
//                console.log(manifests);
                });
                if (!options.acceptLicense) {
                    //$('#license-modal').modal('show');
                }

                //verifyDate(release)
            }

            function initTour() {
            }

            function tourStart() {
            }
            function initialize() {
                currentPerspective = "home";
                componentsRegistry = [];
                $("#welcome-perspective").css({"display":"block"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("<em>...</em>");
            }
            function switchToBrowsing(cd1Value, cd2Value, txValue1) {
                currentPerspective = "browsing";
                if (componentsRegistry){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }

                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"block"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("Browsing");
                var tpt = new taxonomyPanel(document.getElementById("bp-taxonomy_canvas"), txValue1, options);
                var spa = new searchPanel(document.getElementById("bp-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("bp-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("bp-cd2_canvas"), cd2Value, options);
                cdPanel1.subscribe(tpt);
                cdPanel1.setupCanvas();
                cdPanel2.subscribe(spa);
                cdPanel2.setupCanvas();
                $('#spliter2').split({orientation: 'vertical', limit: 20, position: '30%'});
                $('#searchDetails').split({orientation: 'horizontal', limit: 10});
                $('#details').split({orientation: 'vertical', limit: 20});
                switchLanguage(selectedLanguage, selectedFlag, false);
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
            }
            function switchToComparingConcepts(cd1Value, cd2Value) {
                currentPerspective = "compare_concepts";
                currentPerspective = "browsing";
                if (componentsRegistry){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }

                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"block"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("Comparing concepts");
                var spa = new searchPanel(document.getElementById("cc-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("cc-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("cc-cd2_canvas"), cd2Value, options);
                cdPanel2.setupCanvas();
                cdPanel1.subscribe(spa);
                cdPanel1.setupCanvas();
                $('#comparing-concepts-wrapper').split({orientation: 'horizontal'});
                $('#comparing-concept-details').split({orientation: 'vertical'});
                switchLanguage(selectedLanguage, selectedFlag, false);
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
            }
            function switchToComparingTaxonomies(cd1Value, txValue1, txValue2) {
                currentPerspective = "compare_hierarchies";
                if (componentsRegistry){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"block"});
                $("#full-height-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("Comparing taxonomies");
                var tx1 = new taxonomyPanel(document.getElementById("ct-tx1_canvas"), txValue1, options);
                var tx2 = new taxonomyPanel(document.getElementById("ct-tx2_canvas"), txValue2, options);
                var spa = new searchPanel(document.getElementById("ct-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("ct-cd1_canvas"), cd1Value, options);
                cdPanel1.subscribe(spa);
                cdPanel1.setupCanvas();
                $('#comparing-taxonomies-wrapper').split({orientation: 'horizontal'});
                $('#taxonomies-canvas-wrapper').split({orientation: 'vertical'});
                $('#search-cd-wrapper').split({orientation: 'vertical'});
                switchLanguage(selectedLanguage, selectedFlag, false);
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
            }
            function switchToFullHeight(cd1Value, txValue1) {
                currentPerspective = "full";
                if (typeof componentsRegistry !="undefined"){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }


                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"block"});
                $("#responsive-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("Full");
                var fhOptions = jQuery.extend(true, {}, options);
                fhOptions.subscribersMarker = false;
                fhOptions.linkerButton = false;
                var tpt = new taxonomyPanel(document.getElementById("fh-taxonomy_canvas"), txValue1, fhOptions);
                var fav = new favoritePanel(document.getElementById("fh-favorites_canvas"), fhOptions);
                var ref = new refsetPanel(document.getElementById("fh-refset_canvas"), fhOptions);
                var spa = new searchPanel(document.getElementById("fh-search_canvas"), fhOptions);
                var devqp = new queryComputerPanel(document.getElementById("fh-query_dev_canvas"), fhOptions);
                var cdPanel1 = new conceptDetails(document.getElementById("fh-cd1_canvas"), cd1Value, fhOptions);
                cdPanel1.subscribe(tpt);
                cdPanel1.subscribe(devqp);
                cdPanel1.subscribe(spa);
                cdPanel1.subscribe(fav);
                cdPanel1.subscribe(ref);
                cdPanel1.setupCanvas();
                $('#spliter-fh').split({orientation: 'vertical', limit: 20, position: '40%'});
                switchLanguage(selectedLanguage, selectedFlag, false);
                if (typeof QueryString.searchTerm != "undefined") {
                    $('#fh-tabs li:eq(1) a').tab('show');
                    searchInPanel(spa.divElement.id, decodeURI(QueryString.searchTerm));
                }
                $.each(componentsRegistry, function (i, field){
                    if (field.loadMarkers)
                        field.loadMarkers();
                });
            }
            function switchToGMDN (cd1Value, txValue1, txValue2){
                currentPerspective = "GMDN";
                if (typeof componentsRegistry =="undefined"){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }

                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"none"});
                $("#GMDN-perspective").css({"display":"block"});
                $("#perspectiveLabel").html("GMDN");
                var tp1 = new taxonomyPanel(document.getElementById("gm-tx1_canvas"), txValue1, options);
                var tp2 = new taxonomyPanel(document.getElementById("gm-tx2_canvas"), 9999999999, options);
                var sp = new searchPanel(document.getElementById("gm-search_canvas"), options);
                var cdPanel = new conceptDetails(document.getElementById("gm-cd1_canvas"), cd1Value, options);
//                tp1.subscribe(tp2);
//                tp2.subscribe(tp1);
                tp2.refsetSubscribe("467614008");
                cdPanel.subscribe(tp1);
                cdPanel.subscribe(tp2);
                cdPanel.subscribe(sp);
                cdPanel.setupCanvas();
                $('#GMDN-wrapper').split({orientation: 'vertical', limit: 20, position: '33%'});
                $('#GMDN-wrapper2').split({orientation:'vertical', limit: 20, position: '50%'});
                $('#GMDN-details').split({orientation: 'horizontal', limit: 10});
                switchLanguage(selectedLanguage, selectedFlag, false);
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
            }
            function switchToResponsiveLayout(cd1Value, cd2Value, txValue1) {
                currentPerspective = "responsive";
                if (componentsRegistry){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }

                $("#welcome-perspective").css({"display":"none"});
                $("#browsing-perspective").css({"display":"none"});
                $("#comparing-concepts-perspective").css({"display":"none"});
                $("#comparing-taxonomies-perspective").css({"display":"none"});
                $("#full-height-perspective").css({"display":"none"});
                $("#responsive-perspective").css({"display":"block"});
                $("#GMDN-perspective").css({"display":"none"});
                $("#perspectiveLabel").html("Responsive");
                var tpt = new taxonomyPanel(document.getElementById("rp-taxonomy_canvas"), txValue1, options);
                var spa = new searchPanel(document.getElementById("rp-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("rp-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("rp-cd2_canvas"), cd2Value, options);
                cdPanel1.subscribe(tpt);
                cdPanel1.setupCanvas();
                cdPanel2.subscribe(spa);
                cdPanel2.setupCanvas();
                $('#spliter2').split({orientation: 'vertical', limit: 20, position: '30%'});
                $('#searchDetails').split({orientation: 'horizontal', limit: 10});
                $('#details').split({orientation: 'vertical', limit: 20});
                switchLanguage(selectedLanguage, selectedFlag, false);
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
            }

            function reloadCurrentPerspective() {
                var cdValue1 = 404684003;
                var cdValue2 = 404684003;
                var txValue1 = 138875005;
                var txValue2 = 138875005;
                if (componentsRegistry){
                    $.each(componentsRegistry, function(i, field){
                        field = null;
                    });
                    componentsRegistry = [];
                }
                
                if (currentPerspective == "home") {
                    initialize();
                } else if (currentPerspective == "browsing") {
                    switchToBrowsing(cdValue1,cdValue2,txValue1);
                } else if (currentPerspective == "full") {
                    switchToFullHeight(cdValue1,txValue1);
                } else if (currentPerspective == "compare_concepts") {
                    switchToComparingConcepts(cdValue1,cdValue2);
                } else if (currentPerspective == "compare_hierarchies") {
                    switchToComparingTaxonomies(cdValue1,txValue1,txValue2);
                } else if (currentPerspective == "responsive") {
                    switchToResponsiveLayout(cdValue1,cdValue2,txValue1);
                } else if (currentPerspective == "GMDN") {
                    switchToGMDN(cdValue1, txValue1, txValue2);
                } else {
                    currentPerspective = "home";
                    initialize();
                }
            }

            function switchRelease(label, edition, release, langRefset, serverUrl) {
//                verifyDate(release);
                $.each(manifests, function (i, field){
                    if (edition == field.databaseName){
                        options.manifest = field;
                        options.textIndexNormalized = options.manifest.textIndexNormalized;
//                        console.log(options.textIndexNormalized);
                    }
                });
                currentPerspective = "home";
                componentsRegistry = [];
                options.edition = edition;
                options.release = release;
                options.langRefset = [langRefset];
                if (serverUrl){
                    options.serverUrl = serverUrl;
                }else{
//                    options.serverUrl = "http://162.243.35.127/api/snomed";
//                    options.serverUrl = "http://104.131.195.232/api/snomed";
                }
                $("#editionLabel").html(label);
            }

            function verifyDate(release) {
                var now = new Date();
                //console.log(release.substring(1, 5) + " " +  release.substring(5, 7) + " " +  release.substring(7, 9));
                var releaseDate = new Date(release.substring(1, 5), release.substring(5, 7)-1, release.substring(7, 9));
                var diff = now - releaseDate;
                diff = Math.round(diff/1000/60/60/24);
                //console.log("Dates: " + now + " " + releaseDate + " " + diff);
                if (diff > 180 ) {
                    //console.log("Alert! outadated...");
                    var alertHtml = '<div class="alert alert-danger" id="outdated-alert">';
                    alertHtml = alertHtml + '<a href="#" class="close" data-dismiss="alert">&times;</a>';
                    alertHtml = alertHtml + '<strong>Warning!</strong> the release you are browsing is more than 6 months old.';
                    alertHtml = alertHtml + '</div>';
                    $("#alert-section").html(alertHtml);
                    $("#outdated-alert").alert();
                } else {
                    $("#alert-section").html("");
                }
            }

            function switchLanguage(language, flagPng, fade) {
            }

        function testPostSvg() {
            var svg = '<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg  xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://web.resource.org/cc/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" ersion="1.1" width="1000px" height="2000px"><defs id="SctDiagramsDefs"><marker id="BlackTriangle" refX="0" refY="10" markerWidth="8" markerHeight="6" orient="auto" viewBox="0 0 22 20" markerUnits="strokeWidth" fill="black" stroke="black" stroke-width="2"><path d="M 0 0 L 20 10 L 0 20 z"></path></marker><marker id="ClearTriangle" refX="0" refY="10" markerWidth="8" markerHeight="8" orient="auto" viewBox="0 0 22 20" markerUnits="strokeWidth" fill="white" stroke="black" stroke-width="2"><path d="M 0 0 L 20 10 L 0 20 z"></path></marker><marker id="LineMarker" refX="0" refY="10" markerWidth="8" markerHeight="8" orient="auto" viewBox="0 0 22 20" markerUnits="strokeWidth" fill="white" stroke="black" stroke-width="2"><path d="M 0 10 L 20 10"></path></marker></defs><rect x="10" y="10" width="148" height="39" id="rect0" fill="#99ccff" stroke="#333" stroke-width="2"></rect><text x="20" y="26" font-family="&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" font-size="10" fill="black">404684003</text><text x="20" y="41" font-family="&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" font-size="12" fill="black">Clinical finding (finding)</text><g><circle cx="100" cy="89" r="20" fill="white" stroke="black" stroke-width="2"></circle><line x1="93" y1="81" x2="107" y2="81" stroke="black" stroke-width="2"></line><line x1="93" y1="92" x2="107" y2="92" stroke="black" stroke-width="2"></line><line x1="94" y1="81" x2="94" y2="92" stroke="black" stroke-width="2"></line><line x1="93" y1="96" x2="107" y2="96" stroke="black" stroke-width="2"></line></g><polyline points="50,49 50,89 65,89" id="poly1" fill="none" stroke="black" stroke-width="2" marker-end="url(#BlackTriangle)"></polyline><circle cx="155" cy="89" r="10" fill="black" stroke="black" stroke-width="2"></circle><polyline points="120,89 120,89 130,89" id="poly1" fill="none" stroke="black" stroke-width="2" marker-end="url(#LineMarker)"></polyline><rect x="195" y="71" width="254" height="39" id="rect1" fill="#99ccff" stroke="#333" stroke-width="2"></rect><text x="205" y="87" font-family="&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" font-size="10" fill="black">138875005</text><text x="205" y="102" font-family="&quot;Helvetica Neue&quot;,Helvetica,Arial,sans-serif" font-size="12" fill="black">SNOMED CT Concept (SNOMED RT+CTV3)</text><polyline points="155,89 155,90.5 180,90.5" id="poly1" fill="none" stroke="black" stroke-width="2" marker-end="url(#ClearTriangle)"></polyline></svg>';
            $.post("http://127.0.0.1:3000/util/svg2png", { svgContent: svg}).done(function( response ) {
                console.log(response);
            }).fail(function() {
                console.log("Error");
            });
        }

        </script>
        <style>
            .ribbon {
                background-color: #a00;
                overflow: hidden;
                white-space: nowrap;
                position: absolute;
                left: -47px;
                top: 22px;
                -webkit-transform: rotate(-45deg);
                -moz-transform: rotate(-45deg);
                -ms-transform: rotate(-45deg);
                -o-transform: rotate(-45deg);
                transform: rotate(-45deg);
            }
            .ribbon span {
                border: 1px solid #faa;
                color: #fff;
                display: block;
                font: bold 100% 'Helvetica Neue', Helvetica, Arial, sans-serif;
                margin: 1px 0;
                padding: 3px 70px;
                text-align: center;
                text-decoration: none;
            }
            .navbar-brand {
                margin-left: 50px;
            }
        </style>
    </head>
    <body onLoad="start();" style="height: 100%; display: block;">
        <nav class="navbar navbar-default  navbar-static-top" role="navigation">
            <div id="mainDiv">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                </button>
                <div class="ribbon"><span>Dev</span></div>
                <a class="navbar-brand" href="javascript:void(0);" onclick="initialize();" id="navBarBrand"><strong>
                     	&nbsp;&nbsp;<span class="i18n" data-i18n-id="i18n_app_name">IHTSDO SNOMED CT Browser</span></strong></a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-left: 20px; padding-right: 20px;">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="navbar-btn" id="edition-selector">
                            <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
                                <span class="i18n" data-i18n-id="i18n_release">Release</span>:&nbsp;<span id="editionLabel">International Edition 20140131</span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <!--<li><a href="javascript:void(0);" onclick="switchRelease('International Edition 20140131', 'en-edition', 'v20140131', '900000000000509007');reloadCurrentPerspective();">International Edition 20140131</a></li>-->
                                <!--<li><a href="javascript:void(0);" onclick="switchRelease('Spanish Edition 20140131', 'multi-edition', 'v20140430', '900000000000509007');reloadCurrentPerspective();">Spanish Edition 20140430</a></li>-->
                                <!--<li><a href="javascript:void(0);" onclick="switchRelease('Danish Edition 20140131', 'da-edition', 'v20131018', '554461000005103');reloadCurrentPerspective();">Danish Edition 20131018</a></li>-->
                                <!--<li><a href="javascript:void(0);" onclick="switchRelease('Swedish Edition 20131130', 'sv-edition', 'v20131130', '46011000052107');reloadCurrentPerspective();">Swedish Edition 20131130</a></li>-->
                            </ul>
                        </li>
                        <li class="navbar-text"></li>
                        <li class="navbar-btn" id="perspective-selector">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                <span class="i18n" data-i18n-id="i18n_perspective">Perspective</span>:&nbsp;<span id="perspectiveLabel"><em>...</em></span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0);" onclick="switchToFullHeight(404684003, 138875005);"><span class="i18n" data-i18n-id="i18n_full_perspective">Full</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToBrowsing(404684003,404684003);"><span class="i18n" data-i18n-id="i18n_browsing_perspective">Browsing</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToComparingConcepts(404684003,404684003);"><span class="i18n" data-i18n-id="i18n_comp_concepts_perspective">Comparing concepts</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToComparingTaxonomies(404684003);"><span class="i18n" data-i18n-id="i18n_comp_hier_perspective">Comparing hierarchy</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToGMDN(404684003, 138875005);"><span class="i18n" data-i18n-id="i18n_comp_hier_perspective">GMDN</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToResponsiveLayout(404684003,404684003);"><span class="i18n" data-i18n-id="i18n_responsive_perspective">Responsive (tablets, phones)</span></a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="i18n" data-i18n-id="i18n_about">About</span> <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="mailto:otf@ihtsdo.org?subject=feedback" target="_blank"><span class="i18n" data-i18n-id="i18n_provide_feedback">Provide feedback on this browser</span></a></li>
                                <li><a href="https://github.com/IHTSDO/snomed-interaction-components" target="_blank"><span class="i18n" data-i18n-id="i18n_github">See the code on GitHub</span></a></li>
                              <!--  <li><a href="#">About SNOMED CT</a></li> -->
                                <li class="divider"></li>
                                <li><a href="http://www.ihtsdo.org" target="_blank">IHTSDO.org</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span id="nav-selected-flag"></span> <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0);" onclick="switchLanguage('en_US', 'img/flags/us.png', true);"><img src="img/flags/us.png"> English</a></li>
                                <li><a href="javascript:void(0);" onclick="switchLanguage('es', 'img/flags/es.png', true);"><img src="img/flags/es.png"> Espa침ol</a></li>
<!--                                <li><a href="javascript:void(0);" onclick="switchLanguage('pt', 'img/flags/pt.png', true);"><img src="img/flags/pt.png"> Portuguese</a></li>
                                <li><a href="javascript:void(0);" onclick="switchLanguage('en_GB', 'img/flags/gb.png', true);"><img src="img/flags/gb.png"> English (GB)</a></li>
                                <li><a href="javascript:void(0);" onclick="switchLanguage('se', 'img/flags/se.png', true);"><img src="img/flags/se.png"> Swedish</a></li> -->
                                <li><a href="javascript:void(0);" onclick="switchLanguage('da', 'img/flags/dk.png', true);"><img src="img/flags/dk.png"> Dansk</a></li>
                                <li class="divider"></li>
                                <li style="margin: 5px;"><em><span class="i18n text-muted small" data-i18n-id="i18n_translation_warning">This option only applies to the Browser. Terminology language depends on the selected edition.</span></em></li>
                            </ul>
                        </li>
                        <img class="pull-right visible-lg" src="img/logo.png" alt="IHTSDO delivering SNOMED, the global clinical terminology">
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
        <div id="alert-section">
        </div>
        <div class="container-fluid" style="height: 100%">
            <!-- Welcome Perspective -->
            <div id="welcome-perspective"  class="bperspective">
                <div class="jumbotron">
                    <h1><span class="i18n" data-i18n-id="i18n_welcome">Welcome</span></h1>
                    <p><span class="i18n" data-i18n-id="i18n_home1">This is a beta... a work in progress of ways to browse and search SNOMED CT as part of development within the IHTSDO Open Tooling Framework, by the IHTSDO and its development partners</span></p>
                    <p><span class="i18n" data-i18n-id="i18n_home2">Please select a SNOMED CT release and a perspective from the top menu to start, or...</span></p>
                    <p>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Daily build', 'en-edition', 'v20180131', '900000000000509007', 'https://prod-dailybuild.ihtsdotools.org/api/snomed');
                                switchToFullHeight(404684003, 138875005);"><img src="img/box-logo.png" style="height:20px">&nbsp;&nbsp;&nbsp;<span class="i18n"data-i18n-id="i18n_go_browsing">Go browsing...</span><br><span class="small    ">International edition<br>January 2016 (Data v2)</span></a>
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="testPostSvg();"><img src="img/flags/us.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Terms and UI in English</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Spanish Edition 20140430', 'es-edition', 'v20140430', '450828004', 'http://107.170.143.181/api/snomed');switchLanguage('es', 'img/flags/es.png', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/es.png">&nbsp;&nbsp;&nbsp;Ir al Navegador...</span><br><span class="small">Edici칩n en espa침ol</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Danish Edition 20140131', 'dk-edition', 'v20140131', '554461000005103', 'http://104.131.195.232/api/snomed');switchLanguage('da', 'img/flags/dk.png', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/dk.png">&nbsp;&nbsp;&nbsp;G&aring; til browser-siden</span><br><span class="small">Danish edition</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Spanish Edition 20140604', 'multi-edition', 'v20140701', '900000000000509007', 'http://107.170.98.11/api/snomed');switchLanguage('es', 'img/flags/es.png', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/gb.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Multi-English Browser</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Beta release Edition 20150131', 'en-edition', 'v20141125', '900000000000509007', 'http://162.243.35.127/api/snomed');switchLanguage('en', 'img/flags/us.png', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/us.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Beta release Edition 20150131</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('UK Edition 20140401', 'uk-edition', 'v20140401', '900000000000508004');switchLanguage('en_US', 'img/flags/us.png', true);switchToFullHeight(404684003, 138875005);"><img src="img/flags/gb.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">UKTC English Extension</span></a>-->
                        <!--<a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('GMDN Edition 20140604', 'en-edition', 'v20140731', '900000000000509007');switchLanguage('en', 'img/flags/us.png', true);switchToFullHeight(9999999999, 138875005);"><img src="img/flags/gb.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">GMDN</span></a>-->
                        &nbsp;&nbsp;<span class="i18n" data-i18n-id="i18n_or">or</span>&nbsp;&nbsp;
                        <a class="btn btn-primary btn-lg" role="button" onclick="tourStart();"><span class="i18n" data-i18n-id="i18n_take_tour">take the Tour...</span></a></p>
                    <p><span class="i18n" data-i18n-id="i18n_home3">Also, please provide any feedback by emailing <a href="mailto:otf@ihtsdo.org?subject=Browser Feedback" target="_blank">otf@ihtsdo.org</a>. Your feedback is essential to the evolution and improvement of this service.</span></p>
                    <p><span class="i18n" data-i18n-id="i18n_home4">If you would like to get involved in the development, this code is available under an Apache v2 open source license. Please visit the open source repository in the <a href="https://github.com/IHTSDO/snomed-interaction-components" target="_blank">IHTSDO GitHub account</a></span></p>
                    <!--<p><a class="btn btn-primary btn-lg" role="button" onclick="client.setText('esto est치 el clipboard!');console.log('copy');"><img src="img/flags/gb.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Copy to clipboard</span></a></p>-->
                    <p><span class="i18n" data-i18n-id="i18n_home5">Don't be surprised if you see frequent changes. Similarly, please don't depend on this tool being available all the time whilst in beta, but please look around and try it out!</span></p>
                    <span id="releasesButtons">
                        <i class='glyphicon glyphicon-refresh icon-spin'></i>
                    </span>
                </div>
                <p><span class="i18n" data-i18n-id="i18n_home6"><span class="btn-success"><em>Releases</em></span> will allow the selection of SNOMED CT content from the International Edition or other extensions, with specific dates.</span></p>
                <p><span class="i18n" data-i18n-id="i18n_home7"><span class="btn-primary"><em>Perspectives</em></span>  are pre-defined browsing layouts for specific purposes. Use the <a href="javascript:void(0);" onclick="switchToResponsiveLayout(404684003,404684003);">responsive perspective</a> for best results in tablets and phones.</span></p>
            </div>
            <!-- Browsing Perspective -->
            <div id="browsing-perspective" class="bperspective">
                <div id="spliter2" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="a panel panel-default" style="border-radius: 0px;">
                        <div id="bp-taxonomy_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                    <div class="" id="searchDetails">
                        <div class="row panel panel-default" style="border-radius: 0px;" >
                            <div class="col-md-12" id="bp-search_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="" id="details" >
                            <div class="col-md-6 panel panel-default" style="border-radius: 0px;" >
                                <div class="col-md-12" id="bp-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                            </div>
                            <div class="col-md-6 panel panel-default" style="border-radius: 0px;" >
                                <div class="col-md-12" id="bp-cd2_canvas" style="padding: 0px;margin: 0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Comparing concepts -->
            <div id="comparing-concepts-perspective" class="bperspective">
                <div id="comparing-concepts-wrapper" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="" id="comparing-concept-details" >
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="cc-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="cc-cd2_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div class="">
                        <div class="col-md-12" id="cc-search_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                </div>
            </div>
            <!-- Comparing hierarchy -->
            <div id="comparing-taxonomies-perspective" class="bperspective">
                <div id="comparing-taxonomies-wrapper" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="" id="taxonomies-canvas-wrapper">
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-tx1_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-tx2_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div class="" id="search-cd-wrapper">
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-search_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-cd1_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Full Perspective -->
            <div id="full-height-perspective" class="bperspective">
                <div id="spliter-fh" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="a panel panel-default" id="fh-tabs-pane" style="border-radius: 0px;">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" id="fh-tabs">
                            <li class="active">
                                <a href="#fh-taxonomy_canvas" data-toggle="tab">
                                    <div>
                                        <span ondrop="dropT(event, 'fh-taxonomy_canvas');$('#fh-tabs a:first').tab('show');" ondragleave="removeHighlight();" ondragover="allowDrop(event)" class="i18n" data-i18n-id="i18n_taxonomy">Taxonomy</span>
                                    </div>
                                </a>
                            </li>
                            <li><a href="#fh-search_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_search">Search</span></a></li>
<!--                            <li id="fh-favorites_canvas-li"><a href="#fh-favorites_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_favorites">Favorites</span></a></li>-->
<!--                            <li id="fh-refset_canvas-li"><a href="#fh-refset_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_refset">Refset</span></a></li>-->
                            <li id="fh-query_dev_canvas-li"><a href="#fh-query_dev_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_query">Query</span></a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="fh-taxonomy_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-search_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-favorites_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-refset_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-query_dev_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div class="" id="conceptDetails-fh">
                        <div class="col-md-12" id="fh-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                </div>
            </div>
            <!-- GMDN Perspective -->
            <div id="GMDN-perspective" class="bperspective">
                <div id="GMDN-wrapper" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="" id="GMDN-details" >
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="gm-tx1_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="gm-tx2_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div id="GMDN-wrapper2">
                        <div class="col-md-12" id="gm-search_canvas" style="padding: 0px;margin: 0;"></div>
                        <div class="col-md-12" id="gm-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                </div>
            </div>
            <!-- Responsive Perspective -->
            <div id="responsive-perspective" class="bperspective">
                <div id="comparing-taxonomies-wrapper3" class="row" style="width:100%; height: 91%; position: absolute;padding: 0px !important;margin: 0 !important;">
                    <div class="row">
                        <div id="rp-taxonomy_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-cd1_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-search_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-cd2_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- License agreement modal -->
         <div class="modal fade" id="license-modal" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"><span class="i18n" data-i18n-id="i18n_licence_agreement">IHTSDO SNOMED CT Browser (beta) Licence Agreement</span></h4>
                    </div>
                    <div class="modal-body">
                            <p><span class="i18n" data-i18n-id="i18n_licence_agreement_1">In order to use the IHTSDO SNOMED CT Browser, please accept the following licence agreement</span>:</p>
                            <div style="height: 300px; overflow: auto; margin: 20px; border: 1px solid; padding: 10px;">
                            <p><span class="i18n" data-i18n-id="i18n_licence_agreement_2"><strong>IHTSDO SNOMED CT Browser</strong> includes SNOMED Clinical Terms춽 (SNOMED CT춽) which is used by permission of the International Health Terminology Standards Development Organization (IHTSDO). All rights reserved. SNOMED CT춽 was originally created by the College of American Pathologists.</span>
                               <span class="i18n" data-i18n-id="i18n_licence_agreement_3">SNOMED, SNOMED CT and SNOMED Clinical Terms are registered trademarks of the IHTSDO</span> (<a href="http://www.ihtsdo.org">www.ihtsdo.org</a>).</p>
                            <p><span class="i18n" data-i18n-id="i18n_licence_agreement_4">Use of SNOMED CT in <strong>IHTSDO SNOMED CT Browser</strong> is governed by the conditions of the following SNOMED CT license issued by the IHTSDO</span>:</p>
                            <p style="margin-left: 20px;">1. <span class="i18n" data-i18n-id="i18n_licence_agreement_5">The meaning of the terms ㄹffiliate, or Data Analysis System, Data Creation System, Derivative, End User, Extension, Member, Non-Member Territory, SNOMED CT and SNOMED CT Content are as defined in the IHTSDO Affiliate License Agreement (see www.ihtsdo.org/license.pdf)</span>.</p>
                            <p style="margin-left: 20px;">2. <span class="i18n" data-i18n-id="i18n_licence_agreement_6">Information about Affiliate Licensing is available at <a href="http://www.ihtsdo.org/license">www.ihtsdo.org/license</a>. Individuals or organizations wishing to register as IHTSDO Affiliates can register at <a href="http://www.ihtsdo.org/salsa">www.ihtsdo.org/salsa</a>, subject to acceptance of the Affiliate License Agreement (see <a href="http://www.ihtsdo.org/license.pdf">www.ihtsdo.org/license.pdf)</a></span>.</p>
                            <p style="margin-left: 20px;">3. <span class="i18n" data-i18n-id="i18n_licence_agreement_7">The current list of IHTSDO Member Territories can be viewed at <a href="http://www.ihtsdo.org/members">www.ihtsdo.org/members</a>. Countries not included in that list are Non-Member Territories</span>.</p>
                            <p style="margin-left: 20px;">4. <span class="i18n" data-i18n-id="i18n_licence_agreement_8">End Users, that do not hold an IHTSDO Affiliate License, may access SNOMED CT춽 using <strong>IHTSDO SNOMED CT Browser</strong> subject to acceptance of and adherence to the following sub-license limitations</span>:</p>
                            <p style="margin-left: 40px;">a) <span class="i18n" data-i18n-id="i18n_licence_agreement_9">The sub-licensee is only permitted to access SNOMED CT춽 using this software (or service) for the purpose of exploring and evaluating the terminology</span>.</p>
                            <p style="margin-left: 40px;">b) <span class="i18n" data-i18n-id="i18n_licence_agreement_10">The sub-licensee is not permitted the use of this software as part of a system that constitutes a SNOMED CT Data Creation System or Data Analysis System, as defined in the IHTSDO Affiliate License. This means that the sub-licensee must not use <strong>IHTSDO SNOMED CT Browser</strong> to add or copy SNOMED CT identifiers into any type of record system, database or document</span>.</p>
                            <p style="margin-left: 40px;">c) <span class="i18n" data-i18n-id="i18n_licence_agreement_11">The sub-licensee is not permitted to translate or modify SNOMED CT Content or Derivatives</span>.</p>
                            <p style="margin-left: 40px;">d) <span class="i18n" data-i18n-id="i18n_licence_agreement_12">The sub-licensee is not permitted to distribute or share SNOMED CT Content or Derivatives</span>.</p>
                            <p style="margin-left: 20px;">5. <span class="i18n" data-i18n-id="i18n_licence_agreement_13">IHTSDO Affiliates may use <strong>IHTSDO SNOMED CT Browser</strong> as part of a Data Creation System or Data Analysis System subject to the following conditions</span>:</p>
                            <p style="margin-left: 40px;">a) <span class="i18n" data-i18n-id="i18n_licence_agreement_14">The IHTSDO Affiliate, using <strong>IHTSDO SNOMED CT Browser</strong> must accept full responsibility for any reporting and fees due for use or deployment of such a system in a Non-Member Territory</span>.</p>
                            <p style="margin-left: 40px;">b) <span class="i18n" data-i18n-id="i18n_licence_agreement_15">The IHTSDO Affiliate must not use <strong>IHTSDO SNOMED CT Browser</strong> to access or interact with SNOMED CT in any way that is not permitted by the Affiliate License Agreement</span>.</p>
                            <p style="margin-left: 40px;">c) <span class="i18n" data-i18n-id="i18n_licence_agreement_16">In the event of termination of the Affiliate License Agreement, the use of <strong>IHTSDO SNOMED CT Browser</strong> will be subject to the End User limitations noted in 4</span>.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="http://www.ihtsdo.org" class="btn btn-danger"><span class="i18n" data-i18n-id="i18n_reject">Reject</span></a>
                        <button type="button" class="btn btn-success" data-dismiss="modal"><span class="i18n" data-i18n-id="i18n_accept">Accept</span></button>
                        <div class="btn-group dropup pull-left">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span id="nav-selected-flag-modal"></span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li class="pull-left"><a href="javascript:void(0);" onclick="testPostSvg();"><img src="img/flags/us.png"> English</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('es', 'img/flags/es.png', true);"><img src="img/flags/es.png"> Espa침ol</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('da', 'img/flags/dk.png', true);"><img src="img/flags/dk.png"> Dansk</a></li>
                            </ul>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        
        <!-- JIRA feedback script -->
        <script type="text/javascript" src="https://jira.ihtsdotools.org/s/d41d8cd98f00b204e9800998ecf8427e/en_US-dgb2l9-1988229788/6256/5/1.4.7/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=9215d950"></script>
        
        <!-- Google Analytics script -->
        <script>
			  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  				})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  				ga('create', 'UA-41892858-7', 'ihtsdotools.org');
  				ga('send', 'pageview');

		</script>
        <script>
            manualStateChange = true;
            History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
                if(manualStateChange == true){
                    // BACK BUTTON WAS PRESSED
                    var State = History.getState(); // Note: We are using History.getState() instead of event.state
                    if (State.data && State.data.url) {
                        //console.log("Back button! ", State.data.name);
                        if (State.data.url.indexOf("acceptLicense") == -1) {
                            State.data.url = State.data.url + "&acceptLicense=true";
                        }
                        window.location.href = State.data.url;
                    }
                }
                manualStateChange = true;
            });
        </script>
    </body>
</html>