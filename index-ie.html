<!DOCTYPE html>
<html>
    <head>
        <title>SNOMED International Browser</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="cache-control" content="no-cache">
        <meta name="viewport" content="width=device-width">
		<meta name="description" content="SNOMED International SNOMED CT Browser">
		<meta name="author" content="SNOMED International">
		<link rel="icon" type="image/png"  href="favicon.png">

        <script src="external-libs/jquery-2.1.0.min.js" type="text/javascript"></script>
        <script src="external-libs/jquery-ui-1.10.4.custom.min.js" type="text/javascript"></script>
        <script src="external-libs/base64.js" type="text/javascript"></script>
        <script src="external-libs/jquery.svg.js" type="text/javascript"></script>
        <script src="external-libs/jquery.splitter-0.14.0.js" type="text/javascript"></script>
        <script src="external-libs/conduit.min.js" type="text/javascript"></script>
        <script src="external-libs/lodash.js" type="text/javascript"></script>
        <script src="external-libs/postal.min.js" type="text/javascript"></script>
        <script src="external-libs/bootstrap-tour.min.js"></script>
        <script src="external-libs/jquery.i18n.properties-min-1.0.9.js"></script>
        <script src="external-libs/handlebars-v1.3.0.js"></script>
        <script src="external-libs/bootstrap.min.js" type="text/javascript"></script>
        <script src="external-libs/jquery.ui.touch-punch.min.js"></script>
        <script src="external-libs/excellentexport.min.js"></script>
        <script src="external-libs/notify.js"></script>
        <script src="external-libs/clipboard.min.js"></script>
        <script src="external-libs/popover-extra-placements.js" type="text/javascript"></script>

        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/jquery.splitter.css">
        <link rel="stylesheet" href="css/jquery-ui-1.10.4.custom.min.css">
        <link rel="stylesheet" href="css/bootstrap.min.base.12.css">
        <link rel="stylesheet" href="css/bootstrap-tour.css">
        <link rel="stylesheet" href="css/popover-extra-placements.css">
        <link rel="stylesheet" href="css/animate.css">

        <link rel="stylesheet" href="snomed-interaction-components/css/snomed-interaction-components-1.37.3.min.css">
        <script src="snomed-interaction-components/js/snomed-interaction-components-1.37.3.min.js"></script>
        <script src="external-libs/jquery.history.js"></script>
        <script src="external-libs/ZeroClipboard.js"></script>

        <script type="text/javascript">
            function getCookie(c_name) {
                if (document.cookie.length > 0) {
                    var c_start = document.cookie.indexOf(c_name + "=");
                    if (c_start != -1) {
                        c_start = c_start + c_name.length + 1;
                        c_end = document.cookie.indexOf(";", c_start);
                        if (c_end == -1) {
                            c_end = document.cookie.length;
                        }
                        return unescape(document.cookie.substring(c_start, c_end));
                    }
                }
                return "";
            }

            function createCookie(name, value, days) {
                var expires;
                if (days) {
                    var date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toGMTString();
                }
                else {
                    expires = "";
                }
                document.cookie = name + "=" + value + expires + "; path=/";
            }

            var enableQueriesInFullPerspective = false;
            var selectedLanguage = 'en_US';
            var selectedFlag = 'img/flags/us.png';
            var currentPerspective = "home";

            //It can be time consuming to load all the collections into mongo.  If you are only loading one collection
            //set it here and all GUI elements will use this collection.  Used by switchReleases function
            var mongoDetails = {
                useMe: false,//if set to false this is ignored and normal defaults are taken, if true all the parameters are used!
                database: 'test',
                collection: 'concepts',
                mongoRestServer: 'http://localhost:3000/snomed'
            };

            var options = {
                serverUrl: "http://browser.ihtsdotools.org/api/v1/snomed",
//                queryServerUrl: "http://sct-rest.ihtsdotools.org/api/snomed/",
                edition: "en-edition",
                release: "v20180131",
                showIds: false,
                hideNotAcceptable: true,
                displayInactiveDescriptions: false,
                displaySynonyms: true,
                selectedView: "inferred",
                displayChildren: false,
                langRefset: ["900000000000509007"],
                closeButton: false,
                collapseButton: false,
                linkerButton: true,
                subscribersMarker: true,
                searchMode: "partialMatching",
                searchLang: "english",
                diagrammingMarkupEnabled: false,
                statusSearchFilter: "activeOnly",
                highlightByEffectiveTime: "false"
            };

            options.languageNameOfLangRefset = {
                "20581000087109": "fr-CA",
                "19491000087109": "en-CA",
                "21000172104": "fr-BE",
                "31000172101": "nl-BE",
                "900000000000508004": "GB",
                "900000000000509007": "US",
                "450828004":"ES",
                "554461000005103":"DA",
                "46011000052107":"SV",
                "32570271000036106":"AU",
                "271000210107":"NZ-EN",
                "291000210106":"NZ-MI",
//                "999001251000000103":"UK",
                "11000146104":"NL",
                "15551000146102":"NL-PF",
            };

            if (mongoDetails.useMe) {
                options.serverUrl = mongoDetails.mongoRestServer
            }
            var manifests;
            function loadManifests(){
                xhrM = $.getJSON(options.serverUrl.replace("/snomed", "") + "/server/releases", function (result) {
                    // nothing
                }).done(function (result) {
                    manifests = result;
                    //console.log(result);
                }).fail(function () {
                    $.notify("Error Terminology server not accessible!", {
                        autoHide: false,
                        className: "error"
                    });
//                alert("Error Terminolgy server not accesed");
                    console.log("fail Manifest");
                });
                $.when(xhrM).done(function () {
                    xhr = $.getJSON("https://prod-browser-exten.ihtsdotools.org/api/snomed".replace("snomed", "") + "server/releases", function (result) {
                        // nothing
                    }).done(function (result) {
                        $.each(result, function (i, field) {
                            manifests.push(field);
                        });
                        start();
                    }).fail(function () {
                        $.notify("Error Terminology server not accessible!", {
                            autoHide: false,
                            className: "error"
                        });
//                console.log("fail Manifest");
                    });
                });
            }

            var tours = {};
            var tour;

            var QueryString = function () {
                var query_string = {};
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (typeof query_string[pair[0]] === "undefined") {
                        query_string[pair[0]] = pair[1];
                    } else if (typeof query_string[pair[0]] === "string") {
                        var arr = [query_string[pair[0]], pair[1]];
                        query_string[pair[0]] = arr;
                    } else {
                        query_string[pair[0]].push(pair[1]);
                    }
                }
                return query_string;
            }();

            function start() {
                // Read parameters
                $(function() {
                    $.extend($.fn.disableTextSelect = function() {
                        return this.each(function() {
                            $(this).mousedown(function() {
                                return false;
                            });
                        });
                    });
                    $('.noSelect').disableTextSelect(); //No text selection on elements with a class of 'noSelect'
                });

                $("#accept-license-button-modal").unbind();
                $("#accept-license-button-modal").click(function(){
                    createCookie("licenseCookie", "true", 2);
                });

                if (typeof QueryString.dev != "undefined") {
                    console.log("Using Dev Server...");
                    //options.serverUrl = "http://107.170.33.116/api";
                }

                if (typeof QueryString.langRefset != "undefined") {
                    options.langRefset = QueryString.langRefset;
                }

                if (typeof QueryString.server != "undefined") {
                    options.serverUrl = QueryString.server;
                }

                var edition = QueryString.edition;
                if (typeof edition == "undefined" || edition == null || edition == "") {
                    edition = "en-edition";
                }
                options.edition = edition;

                var release = QueryString.release;
                if (typeof release == "undefined" || release == null || release == "") {
                    release = "v20170131";
                }
                options.release = release;

                var diagrammingMarkupEnabled = QueryString.diagrammingMarkupEnabled;
                if (typeof diagrammingMarkupEnabled == "undefined" || diagrammingMarkupEnabled == null || diagrammingMarkupEnabled == "") {
                    diagrammingMarkupEnabled = false;
                }
                options.diagrammingMarkupEnabled = diagrammingMarkupEnabled;

//                var langRefset = QueryString.langRefset;
                if (QueryString.langRefset) {
                    var langRefset = QueryString.langRefset.split(",");
                    if (typeof langRefset == "undefined" || langRefset == null || langRefset == "") {
                        langRefset = options.langRefset;
                    }
                    options.langRefset = langRefset;
                }

                $("#editionLabel").html(edition + " " + release);

                if (QueryString.ui_language == "en") {
                    selectedLanguage = 'en_US';
                    selectedFlag = 'img/flags/us.png';
                } else if (QueryString.ui_language == "es") {
                    selectedLanguage = 'es';
                    selectedFlag = 'img/flags/es.png';
                } else if (QueryString.ui_language == "se") {
                    selectedLanguage = 'se';
                    selectedFlag = 'img/flags/se.png';
                } else if (QueryString.ui_language == "da") {
                    selectedLanguage = 'da';
                    selectedFlag = 'img/flags/dk.png';
                } else if (QueryString.ui_language == "pt") {
                    selectedLanguage = 'pt';
                    selectedFlag = 'img/flags/pt.png';
                }

                switchLanguage(selectedLanguage, selectedFlag, false);

                var cdValue1 = QueryString.conceptId1;
                if (typeof cdValue1 == "undefined" || cdValue1 == null || cdValue1 == "") {
                    cdValue1 = 404684003;
                }

                var cdValue2 = QueryString.conceptId2;
                if (typeof cdValue2 == "undefined" || cdValue2 == null || cdValue2 == "") {
                    cdValue2 = 404684003;
                }

                var txValue1 = QueryString.conceptIdTx1;
                if (typeof txValue1 == "undefined" || txValue1 == null || txValue1 == "") {
                    txValue1 = 138875005;
                }

                var txValue2 = QueryString.conceptIdTx2;
                if (typeof txValue2 == "undefined" || txValue2 == null || txValue2 == "") {
                    txValue2 = 138875005;
                }

                var acceptLicense = QueryString.acceptLicense;
                if (typeof acceptLicense == "undefined" || acceptLicense == null || acceptLicense == "") {
                    acceptLicense = false;
                }
                options.acceptLicense = (acceptLicense == "true" || getCookie("licenseCookie") == "true");
//                if (QueryString.edition && QueryString.release){
                    var i = 0;
                    while (i < manifests.length && (manifests[i].databaseName != edition || manifests[i].collectionName != release.substr(1))){
                        i++;
                    }
                    if (i < manifests.length){
                        options.manifest = manifests[i];
                        options.textIndexNormalized = options.manifest.textIndexNormalized;
//                        console.log(options.textIndexNormalized);
//                        verifyDate(options.manifest.expirationDate);
                    }
//                }
                if (QueryString.perspective == "home") {
                    initialize();
                } else if (QueryString.perspective == "browsing") {
                    currentPerspective = "browsing";
                    switchToBrowsing(cdValue1, cdValue2, txValue1);
                } else if (QueryString.perspective == "full") {
                    currentPerspective = "full";
                    switchToFullHeight(cdValue1, txValue1);
                } else if (QueryString.perspective == "compare_concepts") {
                    currentPerspective = "compare_concepts";
                    switchToComparingConcepts(cdValue1, cdValue2);
                } else if (QueryString.perspective == "compare_hierarchies") {
                    currentPerspective = "compare_hierarchies";
                    switchToComparingTaxonomies(cdValue1, txValue1, txValue2);
                } else if (QueryString.perspective == "responsive") {
                    currentPerspective = "responsive";
                    switchToResponsiveLayout(cdValue1, cdValue2, txValue1)
                } else {
                    initialize();
                }
                if (!options.acceptLicense) {
                    $('#license-modal').modal('show');
                }
                //                console.log(manifests);



//                verifyDate(release)
            }

            function initTour() {
                if (typeof tours[selectedLanguage] == "undefined") {
                    tours[selectedLanguage] = new Tour({
                        steps: [
                            {
                                element: "nothing",
                                title: i18n_tour_step1_fh_title,
                                content: i18n_tour_step1_fh_text,
                                placement: "bottom",
                                orphan: true,
                                backdrop: false,
                                onShow: function (tour) {
                                    switchToFullHeight(204351007, 138875005)
                                }
                            },
                            {
                                element: "#fh-tabs-pane",
                                title: i18n_tour_step2_title,
                                content: i18n_tour_step2_text,
                                placement: "right",
                                backdrop: true
                            },
                            {
                                element: "#fh-taxonomy_canvas-taxonomyConfigBar",
                                title: i18n_tour_step5_title,
                                content: i18n_tour_step5_text,
                                placement: "bottom",
                                backdrop: true
                            },
                            {
                                element: "#fh-taxonomy_canvas-treenode-404684003",
                                title: i18n_tour_step10_title,
                                content: i18n_tour_step10_text,
                                placement: "right",
                                backdrop: true
                            },
                            {
                                element: "#fh-taxonomy_canvas-treeicon-404684003",
                                title: i18n_tour_step11_title,
                                content: i18n_tour_step11_text,
                                placement: "right",
                                backdrop: true
                            },
                            {
                                element: "#fh-tabs",
                                title: i18n_tour_step2_5_title,
                                content: i18n_tour_step2_5_text,
                                placement: "bottom",
                                backdrop: true,
                                onNext: function (tour) {
                                    $('#fh-tabs li:eq(1) a').tab('show')
                                }
                            },
                            {
                                element: "#fh-tabs-pane",
                                title: i18n_tour_step3_title,
                                content: i18n_tour_step3_text,
                                placement: "right",
                                backdrop: true
                            },
                            {
                                element: "#fh-search_canvas-searchConfigBar",
                                title: i18n_tour_step6_title,
                                content: i18n_tour_step6_text,
                                placement: "bottom",
                                backdrop: true
                            },
                            {
                                element: "#fh-search_canvas",
                                title: i18n_tour_step12_title,
                                content: i18n_tour_step12_text,
                                placement: "right",
                                backdrop: true
                            },
                            {
                                element: "#fh-search_canvas-historyButton",
                                title: i18n_tour_step13_title,
                                content: i18n_tour_step13_text,
                                placement: "left",
                                backdrop: true,
                                onNext: function (tour) {
                                    $('#fh-tabs li:eq(0) a').tab('show')
                                }
                            },
                            {
                                element: "#fh-cd1_canvas",
                                title: i18n_tour_step4_title,
                                content: i18n_tour_step4_text,
                                placement: "left",
                                backdrop: true
                            },
                            {
                                element: "#fh-cd1_canvas-configButton",
                                title: i18n_tour_step7_title,
                                content: i18n_tour_step7_text,
                                placement: "left",
                                backdrop: true
                            },
                            /*{
                             element: "#fh-taxonomy_canvas-linkerButton",
                             title: i18n_tour_step8_title,
                             content: i18n_tour_step8_text,
                             placement: "left",
                             backdrop: true
                             },
                             {
                             element: "#bp-taxonomy_canvas-subscribersMarker",
                             title: i18n_tour_step9_title,
                             content: i18n_tour_step9_text,
                             placement: "right",
                             backdrop: true
                             },*/
                            {
                                element: "#details-tabs-fh-cd1_canvas",
                                title: i18n_tour_step13_1_title,
                                content: i18n_tour_step13_1_text,
                                placement: "bottom",
                                backdrop: true
                            },
                            {
                                element: "#fh-cd1_canvas-panelBody",
                                title: i18n_tour_step13_2_title,
                                content: i18n_tour_step13_2_text,
                                placement: "left",
                                backdrop: true,
                                onNext: function (tour) {
                                    $('#details-tabs-fh-cd1_canvas li:eq(1) a').tab('show')
                                }
                            },
                            {
                                element: "#fh-cd1_canvas-panelBody",
                                title: i18n_tour_step13_3_title,
                                content: i18n_tour_step13_3_text,
                                placement: "left",
                                backdrop: true
                            },
                            {
                                element: "#fh-cd1_canvas-attributesClip",
                                title: i18n_tour_step14_title,
                                content: i18n_tour_step14_text,
                                placement: "left",
                                backdrop: true,
                                onNext: function (tour) { initialize() }
                            },
                            {
                                element: "nothing",
                                title: i18n_tour_step15_title,
                                content: i18n_tour_step15_text,
                                placement: "bottom",
                                orphan: true,
                                backdrop: true
                            }
                        ],
                        storage: false,
                        debug: false,
                        template: "<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-default' data-role='prev'>« " + i18n_tour_prev + "</button><span data-role='separator'>|</span><button class='btn btn-default' data-role='next'>" + i18n_tour_next + " »</button><button class='btn btn-default' data-role='end'>" + i18n_tour_end_tour + "</button></div></div>"
                    });
                    tour = tours[selectedLanguage];
                    tour.init();
                } else {
                    tour = tours[selectedLanguage];
                }
            }

            function tourStart() {
                if (tour.ended()) {
                    tour.restart();
                } else {
                    tour.start();
                }
            }
            function initialize() {
                var historyUrl = "?";
                manualStateChange = false;
                var state = {
                    name: "Home",
                    conceptId: "",
                    url: historyUrl
                };
                History.pushState(state, "SNOMED CT - Home");
                window.history.pushState("", "", "?");
                componentsRegistry = [];
                postal.unsubscribeFor();
                currentPerspective = "home";
                $("#welcome-perspective").css({"display": "block"});
                $("#browsing-perspective").css({"display": "none"});
                $("#comparing-concepts-perspective").css({"display": "none"});
                $("#comparing-taxonomies-perspective").css({"display": "none"});
                $("#full-height-perspective").css({"display": "none"});
                $("#responsive-perspective").css({"display": "none"});
                $("#perspectiveLabel").html("<em>...</em>");
                $('.more-fields-button').popover('hide');
            }
            function switchToBrowsing(cd1Value, cd2Value, txValue1) {
                currentPerspective = "browsing";
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display": "none"});
                $("#browsing-perspective").css({"display": "block"});
                $("#comparing-concepts-perspective").css({"display": "none"});
                $("#comparing-taxonomies-perspective").css({"display": "none"});
                $("#full-height-perspective").css({"display": "none"});
                $("#responsive-perspective").css({"display": "none"});
                $("#perspectiveLabel").html("Browsing");
                var tpt = new taxonomyPanel(document.getElementById("bp-taxonomy_canvas"), txValue1, options);
                var spa = new searchPanel(document.getElementById("bp-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("bp-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("bp-cd2_canvas"), cd2Value, options);
                cdPanel1.subscribe(tpt);
                cdPanel1.setupCanvas();
                cdPanel2.subscribe(spa);
                cdPanel2.setupCanvas();
                $('#spliter2').split({orientation: 'vertical', limit: 20, position: '30%'});
                $('#searchDetails').split({orientation: 'horizontal', limit: 10});
                $('#details').split({orientation: 'vertical', limit: 20});
                $.each(componentsRegistry, function (i, field){
                    field.loadMarkers();
                });
                switchLanguage(selectedLanguage, selectedFlag, false);
            }
            function switchToComparingConcepts(cd1Value, cd2Value) {
                currentPerspective = "compare_concepts";
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display": "none"});
                $("#browsing-perspective").css({"display": "none"});
                $("#comparing-concepts-perspective").css({"display": "block"});
                $("#comparing-taxonomies-perspective").css({"display": "none"});
                $("#full-height-perspective").css({"display": "none"});
                $("#responsive-perspective").css({"display": "none"});
                $("#perspectiveLabel").html("Comparing concepts");
                var spa = new searchPanel(document.getElementById("cc-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("cc-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("cc-cd2_canvas"), cd2Value, options);
                cdPanel1.subscribe(spa);
                cdPanel1.setupCanvas();
                cdPanel2.setupCanvas();
                $('#comparing-concepts-wrapper').split({orientation: 'horizontal'});
                $('#comparing-concept-details').split({orientation: 'vertical'});
                $.each(componentsRegistry, function (i, field) {
                    field.loadMarkers();
                });
                switchLanguage(selectedLanguage, selectedFlag, false);
            }
            function switchToComparingTaxonomies(cd1Value, txValue1, txValue2) {
                currentPerspective = "compare_hierarchies";
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display": "none"});
                $("#browsing-perspective").css({"display": "none"});
                $("#comparing-concepts-perspective").css({"display": "none"});
                $("#comparing-taxonomies-perspective").css({"display": "block"});
                $("#full-height-perspective").css({"display": "none"});
                $("#responsive-perspective").css({"display": "none"});
                $("#perspectiveLabel").html("Comparing taxonomies");
                var tx1 = new taxonomyPanel(document.getElementById("ct-tx1_canvas"), txValue1, options);
                var tx2 = new taxonomyPanel(document.getElementById("ct-tx2_canvas"), txValue2, options);
                var spa = new searchPanel(document.getElementById("ct-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("ct-cd1_canvas"), cd1Value, options);
                cdPanel1.subscribe(tx2);
                cdPanel1.subscribe(tx1);
                cdPanel1.subscribe(spa);
                cdPanel1.setupCanvas();
                $('#comparing-taxonomies-wrapper').split({orientation: 'horizontal'});
                $('#taxonomies-canvas-wrapper').split({orientation: 'vertical'});
                $('#search-cd-wrapper').split({orientation: 'vertical'});
                $.each(componentsRegistry, function (i, field) {
                    field.loadMarkers();
                });
                switchLanguage(selectedLanguage, selectedFlag, false);
            }
            function switchToFullHeight(cd1Value, txValue1) {
                currentPerspective = "full";
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display": "none"});
                $("#browsing-perspective").css({"display": "none"});
                $("#comparing-concepts-perspective").css({"display": "none"});
                $("#comparing-taxonomies-perspective").css({"display": "none"});
                $("#full-height-perspective").css({"display": "block"});
                $("#responsive-perspective").css({"display": "none"});
                $("#perspectiveLabel").html("Full");
                var fhOptions = jQuery.extend(true, {}, options);
                fhOptions.subscribersMarker = false;
                fhOptions.linkerButton = false;
                var tpt = new taxonomyPanel(document.getElementById("fh-taxonomy_canvas"), txValue1, fhOptions);
                var fav = new favoritePanel(document.getElementById("fh-favorites_canvas"), fhOptions);
                var ref = new refsetPanel(document.getElementById("fh-refset_canvas"), fhOptions);
                var spa = new searchPanel(document.getElementById("fh-search_canvas"), fhOptions);
                var cdPanel1 = new conceptDetails(document.getElementById("fh-cd1_canvas"), cd1Value, fhOptions);
                if (enableQueriesInFullPerspective){
                    $("#fh-query_canvas-li").show();
                    var qpa = new queryComputerPanel(document.getElementById("fh-query_canvas"), fhOptions);
                    cdPanel1.subscribe(qpa);
                }else{
                    $("#fh-query_canvas-li").hide();
                }
                cdPanel1.subscribe(tpt);
                cdPanel1.subscribe(spa);
                cdPanel1.subscribe(fav);
                cdPanel1.subscribe(ref);
                cdPanel1.setupCanvas();
                if (window.screen.width > 1500) {
                    $('#spliter-fh').split({orientation: 'vertical', limit: 20, position: '40%'});
                } else {
                    $('#spliter-fh').split({orientation: 'vertical', limit: 20, position: '50%'});
                }
                if (typeof QueryString.searchTerm != "undefined") {
                    $('#fh-tabs li:eq(1) a').tab('show');
                    searchInPanel(spa.divElement.id, decodeURI(QueryString.searchTerm));
                }
                $.each(componentsRegistry, function (i, field){
                    if (field.loadMarkers)
                        field.loadMarkers();
                });
                switchLanguage(selectedLanguage, selectedFlag, false);
            }
            function switchToResponsiveLayout(cd1Value, cd2Value, txValue1) {
                currentPerspective = "responsive";
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                $("#welcome-perspective").css({"display": "none"});
                $("#browsing-perspective").css({"display": "none"});
                $("#comparing-concepts-perspective").css({"display": "none"});
                $("#comparing-taxonomies-perspective").css({"display": "none"});
                $("#full-height-perspective").css({"display": "none"});
                $("#responsive-perspective").css({"display": "block"});
                $("#perspectiveLabel").html("Responsive");
                var tpt = new taxonomyPanel(document.getElementById("rp-taxonomy_canvas"), txValue1, options);
                var spa = new searchPanel(document.getElementById("rp-search_canvas"), options);
                var cdPanel1 = new conceptDetails(document.getElementById("rp-cd1_canvas"), cd1Value, options);
                var cdPanel2 = new conceptDetails(document.getElementById("rp-cd2_canvas"), cd2Value, options);
                cdPanel1.subscribe(tpt);
                cdPanel1.setupCanvas();
                cdPanel2.subscribe(spa);
                cdPanel2.setupCanvas();
                $('#spliter2').split({orientation: 'vertical', limit: 20, position: '30%'});
                $('#searchDetails').split({orientation: 'horizontal', limit: 10});
                $('#details').split({orientation: 'vertical', limit: 20});
                $.each(componentsRegistry, function (i, field) {
                    field.loadMarkers();
                });
                switchLanguage(selectedLanguage, selectedFlag, false);
            }

            function reloadCurrentPerspective() {
                var cdValue1 = 404684003;
                var cdValue2 = 404684003;
                var txValue1 = 138875005;
                var txValue2 = 138875005;
                if (currentPerspective == "home") {
                    initialize();
                } else if (currentPerspective == "browsing") {
                    switchToBrowsing(cdValue1, cdValue2, txValue1);
                } else if (currentPerspective == "full") {
                    switchToFullHeight(cdValue1, txValue1);
                } else if (currentPerspective == "compare_concepts") {
                    switchToComparingConcepts(cdValue1, cdValue2);
                } else if (currentPerspective == "compare_hierarchies") {
                    switchToComparingTaxonomies(cdValue1, txValue1, txValue2);
                } else if (currentPerspective == "responsive") {
                    switchToResponsiveLayout(cdValue1, cdValue2, txValue1)
                } else {
                    currentPerspective = "home";
                    initialize();
                }
            }

            function switchRelease(label, edition, release, langRefset, serverUrl) {
                if (mongoDetails.useMe) {
                    edition = mongoDetails.database;
                    release = mongoDetails.collection;
                    serverUrl = mongoDetails.mongoRestServer;//serverUrl seems hardcoded in many places throughout the code
                }
//                verifyDate(release);
                if (langRefset == "31000146106") {
                    options.hideNotAcceptable = false;
                }
                postal.unsubscribeFor();
                if (typeof componentsRegistry != "undefined") {
                    $.each(componentsRegistry, function (i, field) {
                        field = null;
                    });
                    componentsRegistry = [];
                }
                var i = 0;
                while (i < manifests.length && (manifests[i].databaseName != edition || manifests[i].collectionName != release.substr(1))){
                    i++;
                }
                i = Math.min(i,manifests.length - 1);//fix array out of bounds causing NPE.

//                console.log(manifests[i].databaseName);
//                console.log(manifests[i].effectiveTime);

                if (i < manifests.length) {
                    options.manifest = manifests[i];
                    options.textIndexNormalized = options.manifest.textIndexNormalized;
//                        console.log(options.textIndexNormalized);
                }
                options.edition = edition;
                options.release = release;
                options.langRefset = langRefset.split(",");
                if (serverUrl){
                    options.serverUrl = serverUrl;
                } else {
                    options.serverUrl = "http://browser.ihtsdotools.org/api/snomed";
                }
                $("#perspective-selector").find("button").first().removeClass("disabled");
                $("#editionLabel").html(label);
            }
            //PWI 20161108 This function went missing at some point.  Returning as urgent P1
                    function verifyDate(release) {
                        var now = new Date();
                        //console.log("releasedate is " + release);
                        //console.log(release.substring(1, 5) + " " +  release.substring(5, 7) + " " +  release.substring(7, 9));
                        var releaseDate = new Date(release.substring(1, 5), release.substring(5, 7) - 1, release.substring(7, 9));
                        if (releaseDate < now) {
        //                    console.log("bien");
                            $("#alert-section").html("");
                        } else {
        //                    console.log("expirada");
                            var alertHtml = '<div class="alert alert-danger" id="outdated-alert">';
                            alertHtml = alertHtml + '<a href="#" class="close" data-dismiss="alert">&times;</a>';
                            alertHtml = alertHtml + '<strong>Warning!</strong> the release you are browsing is expired.';
                            alertHtml = alertHtml + '</div>';
                            $("#alert-section").html(alertHtml);
                            $("#outdated-alert").alert();
                        }
                    }

            function switchLanguage(language, flagPng, fade) {
                selectedLanguage = language;
                selectedFlag = flagPng;
                $("#nav-selected-flag").html('<img src="' + flagPng + '">');
                $("#nav-selected-flag-modal").html('<img src="' + flagPng + '">');
                jQuery.i18n.properties({
                    name: 'Languages',
                    path: 'i18n/',
                    mode: 'both',
                    language: language
                });
                $(".i18n").each(function (index) {
                    var translation = jQuery.i18n.prop($(this).attr('data-i18n-id'));
                    if (translation != "[" + $(this).attr('data-i18n-id') + "]") {
                        if (fade) {
                            $(this).fadeOut("slow", function () {
                                $(this).html(translation);
                                $(this).fadeIn("slow");
                            });
                        } else {
                            $(this).html(translation);
                        }
                    } else {
                        console.log($(this).attr('data-i18n-id') + " = " + $(this).html());
                    }
                });
                initTour();
                $("#navBarBrand").tooltip().tooltip('destroy');
                $("#navBarBrand").tooltip({
                    placement: 'bottom',
                    trigger: 'hover',
                    title: i18n_go_back_home,
                    animation: true,
                    delay: 1000
                });
            }

        </script>
        <style>
            .ribbon {
                background-color: #a00;
                overflow: hidden;
                white-space: nowrap;
                position: absolute;
                left: -47px;
                top: 22px;
                -webkit-transform: rotate(-45deg);
                -moz-transform: rotate(-45deg);
                -ms-transform: rotate(-45deg);
                -o-transform: rotate(-45deg);
                transform: rotate(-45deg);
            }
            .ribbon span {
                border: 1px solid #faa;
                color: #fff;
                display: block;
                font: bold 100% 'Helvetica Neue', Helvetica, Arial, sans-serif;
                margin: 1px 0;
                padding: 3px 70px;
                text-align: center;
                text-decoration: none;
            }
            .navbar-brand {
                margin-top: 4px;
            }
            .navbar .navbar-btn {
                margin-left: 10px;
            }
        </style>
    </head>
    <body onLoad="loadManifests();" style="height: 100%; display: block;">
        <nav class="navbar navbar-default  navbar-static-top" role="navigation">
            <div>
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="javascript:void(0);" onclick="initialize();" id="navBarBrand">
                        <strong>
                            &nbsp;&nbsp;SNOMED CT Browser for Internet Explorer</strong></a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding-left: 20px; padding-right: 20px;">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="navbar-btn" id="edition-selector">
                            <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
                                <span class="i18n" data-i18n-id="i18n_release">Release</span>:&nbsp;<span id="editionLabel">International Edition 20170131</span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="javascript:void(0);" onclick="switchRelease('International Edition 20180131', 'en-edition', 'v20180131', '900000000000509007', 'http://browser.ihtsdotools.org/api/v1/snomed');
                                        reloadCurrentPerspective();">International Edition 20180131</a></li>
                                        <li><a href="javascript:void(0);" onclick="switchRelease('United States Edition 20180301', 'us-edition', 'v20180301','900000000000509007', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                            reloadCurrentPerspective();">US Edition 20180301</a></li>
                                </ul>
                        </li>
                        <li class="navbar-btn" id="perspective-selector">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                                <span class="i18n" data-i18n-id="i18n_perspective">Perspective</span>:&nbsp;<span id="perspectiveLabel"><em>...</em></span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0);" onclick="switchToFullHeight(404684003, 138875005);"><span class="i18n" data-i18n-id="i18n_full_perspective">Full</span></a></li>
                                <!--                                <li><a href="javascript:void(0);" onclick="switchToBrowsing(404684003,404684003, 138875005);"><span class="i18n" data-i18n-id="i18n_browsing_perspective">Browsing</span></a></li> -->
                                <li><a href="javascript:void(0);" onclick="switchToComparingConcepts(404684003, 404684003);"><span class="i18n" data-i18n-id="i18n_comp_concepts_perspective">Comparing concepts</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToComparingTaxonomies(404684003, 138875005, 138875005);"><span class="i18n" data-i18n-id="i18n_comp_hier_perspective">Comparing hierarchy</span></a></li>
                                <li><a href="javascript:void(0);" onclick="switchToResponsiveLayout(404684003, 404684003, 138875005);"><span class="i18n" data-i18n-id="i18n_responsive_perspective">Responsive (tablets, phones)</span></a></li>
                            </ul>
                        </li>
                        <li class="navbar-btn feedback-button">
                            <button type="button" class="btn btn-info" onclick="FreshWidget.show();
                                    return false;">
                                <span class="i18n" data-i18n-id="i18n_feedback">Feedback</span>
                            </button>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="i18n" data-i18n-id="i18n_about">Help</span> <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="https://github.com/IHTSDO/sct-browser-frontend" target="_blank"><span class="i18n" data-i18n-id="i18n_github">See the code on GitHub</span></a></li>
                                <li class="divider"></li>
                                <li><a href="http://www.ihtsdotools.org" target="_blank">SNOMED International Tooling</a></li>
                                <li><a href="http://www.snomed.org" target="_blank">SNOMED International</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span id="nav-selected-flag"></span> <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="javascript:void(0);" onclick="switchLanguage('en_US', 'img/flags/us.png', true);"><img src="img/flags/us.png"> English</a></li>
                                <li class="divider"></li>
                                <li style="margin: 5px;"><em><span class="i18n text-muted small" data-i18n-id="i18n_translation_warning">This option only applies to the Browser. Terminology language depends on the selected edition.</span></em></li>
                            </ul>
                        </li>
                        <li>
                            <p class="pull-right"><a href="http://www.snomed.org" target="_blank"><img class="pull-right visible-lg" src="img/snomed-logo.png" style="width:110px;" alt="SNOMED International delivering SNOMED, the global clinical terminology"></a>
                        </li>
                    </ul>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
        <div id="alert-section">
        </div>
        <div class="container-fluid" style="height: 100%">
            <!-- Welcome Perspective -->
            <div id="welcome-perspective"  class="bperspective">
                <div class="jumbotron">
                    <h1>SNOMED CT Browser for Internet Explorer Compatibility</h1>
                    <p>SNOMED International's SNOMED CT Browser provides ways to browse and search SNOMED CT. The browser has been implemented as part of development within the SNOMED International Open Tooling Framework, by SNOMED International and its development partners</p>
                    <p><span class="i18n" data-i18n-id="i18n_home5">The Browser is provided by the SNOMED International to anyone for reference purposes and the interface and REST APIs are <strong>not</strong> to be used as part of production systems. There are other tools developed by SNOMED International for Members for the use in health care settings.<br>Any abuse of the REST APIs will result in the offending IP address being banned from accessing the browser.</span></p>
                    <h2><span class="i18n" data-i18n-id="i18n_international_editions">International Edition</span></h2>
                    <p>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('International Edition 20180131', 'en-edition', 'v20180131', '900000000000509007', 'http://browser.ihtsdotools.org/api/v1/snomed');
                                switchToFullHeight(404684003, 138875005);"><img src="img/logo.png" style="height:20px">&nbsp;&nbsp;&nbsp;<span class="i18n"data-i18n-id="i18n_go_browsing">Go browsing...</span><br><span class="small    ">International edition<br>January
                                   2018</span></a>
                    </p>
                    <h2><span class="i18n" data-i18n-id="i18n_local_extensions">Local Extensions</span></h2>
                    <p>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Australian Edition 20170930', 'au-edition', 'v20170930','32570271000036106', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('en_US', 'img/flags/au.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/au.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Australian edition<br>2017-09-30</span></a>
    
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Belgian Edition 20180315', 'be-edition', 'v20180315','21000172104,31000172101,900000000000509007', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                            switchLanguage('en_US', 'img/flags/us.png', true);
                                            switchToFullHeight(404684003, 138875005);"><img src="img/flags/be.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Belgian edition<br>2018-03-15</span></a>
    
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Canadian Edition 20180430', 'ca-edition', 'v20180430','19491000087109,20581000087109', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('en_US', 'img/flags/ca.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/ca.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Canadian edition<br>2018-04-30</span></a>
    
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Danish Edition 20180331', 'dk-edition', 'v20180331','554461000005103', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('da', 'img/flags/dk.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/dk.png">&nbsp;&nbsp;&nbsp;G&aring; til browser-siden</span><br><span class="small">Danish edition<br>2018-03-31</span></a>
    
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Netherlands Edition 20180331', 'nl-edition', 'v20180331','31000146106', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('en_US', 'img/flags/us.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/nl.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Netherlands edition<br>2018-03-31</span></a>
                    </p>
                    <p>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Swedish Edition 20171130', 'se-edition', 'v20171130','46011000052107', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('se', 'img/flags/se.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/se.png">&nbsp;&nbsp;&nbsp;Börja söka...</span><br><span class="small">Swedish edition<br>2017-11-30</span></a>
                        <a class="btn btn-primary btn-lg" role="button" href="https://termbrowser.nhs.uk/" target="_blank"><img src="img/flags/gb.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">United Kingdom edition<br>(hosted by the UK)</span></a>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('United States Edition 20180301', 'us-edition', 'v20180301','900000000000509007', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('en_US', 'img/flags/us.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/us.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">United States edition<br>2018-03-01</span></a>
                        <a class="btn btn-primary btn-lg" role="button" onclick="switchRelease('Uruguay Edition 20171215', 'uy-edition', '2017-12-15','5641000179103', 'https://prod-browser-exten.ihtsdotools.org/api/snomed');
                                    switchLanguage('es', 'img/flags/uy.png', true);
                                    switchToFullHeight(404684003, 138875005);"><img src="img/flags/uy.png">&nbsp;&nbsp;&nbsp;Go browsing...</span><br><span class="small">Uruguay edition<br>2017-12-15</span></a>
                    </p>
                                       <p>
                        &nbsp;&nbsp;<span class="i18n" data-i18n-id="i18n_or">or</span>&nbsp;&nbsp;
                        <a class="btn btn-primary " role="button" onclick="tourStart();"><span class="i18n" data-i18n-id="i18n_take_tour">take the Tour...</span></a></p>

                    <p><span class="i18n" data-i18n-id="i18n_home4">If you would like to get involved in the development, this code is available under an Apache v2 open source license. You can also find more information on the current backlog of feedback that is up for possible development here - <a href="https://confluence.ihtsdotools.org/display/TOOLS/SNOMED+CT+Browser" target="_blank">SNOMED International Browser service page</a></span></p>
                    <p><button class=livechat-room>Chat</button>
                </div>
                <p><span class="i18n" data-i18n-id="i18n_home6"><span class="btn-success"><em>Releases</em></span> will allow the selection of SNOMED CT content from the International Edition or other extensions, with specific dates.</span></p>
                <p><span class="i18n" data-i18n-id="i18n_home7"><span class="btn-primary"><em>Perspectives</em></span>  are pre-defined browsing layouts for specific purposes. Use the <a href="javascript:void(0);" onclick="switchToResponsiveLayout(404684003, 404684003, 138875005);">responsive perspective</a> for best results in tablets and phones.</span></p>
            </div>
            <!-- Browsing Perspective -->
            <div id="browsing-perspective" class="bperspective">
                <div id="spliter2" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="a panel panel-default" style="border-radius: 0px;">
                        <div id="bp-taxonomy_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                    <div class="" id="searchDetails">
                        <div class="row panel panel-default" style="border-radius: 0px;" >
                            <div class="col-md-12" id="bp-search_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="" id="details" >
                            <div class="col-md-6 panel panel-default" style="border-radius: 0px;" >
                                <div class="col-md-12" id="bp-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                            </div>
                            <div class="col-md-6 panel panel-default" style="border-radius: 0px;" >
                                <div class="col-md-12" id="bp-cd2_canvas" style="padding: 0px;margin: 0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer>
                <p>
                    <small><b>&copy; SNOMED International 2018</b> v1.37.3</small>
                </p>
            </footer>

            <!-- Comparing concepts -->
            <div id="comparing-concepts-perspective" class="bperspective">
                <div id="comparing-concepts-wrapper" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="" id="comparing-concept-details" >
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="cc-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="cc-cd2_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div class="">
                        <div class="col-md-12" id="cc-search_canvas" style="padding: 0px;margin: 0;"></div>
                    </div>
                </div>
            </div>
            <!-- Comparing hierarchy -->
            <div id="comparing-taxonomies-perspective" class="bperspective">
                <div id="comparing-taxonomies-wrapper" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="" id="taxonomies-canvas-wrapper">
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-tx1_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-tx2_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <div class="" id="search-cd-wrapper">
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-search_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                        <div class="col-md-6" style="padding: 0px;margin: 0;">
                            <div class="col-md-12" id="ct-cd1_canvas"  style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Full Perspective -->
            <div id="full-height-perspective" class="bperspective">
                <div id="spliter-fh" class="row" style="width:100%; height: 91%; position: absolute;">
                    <div class="a panel panel-default" id="fh-tabs-pane" style="border-radius: 0px;">
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" id="fh-tabs">
                            <li class="active">
                                <a href="#fh-taxonomy_canvas" data-toggle="tab">
                                    <div>
                                        <span ondrop="dropT(event, 'fh-taxonomy_canvas');$('#fh-tabs a:first').tab('show');" ondragleave="removeHighlight();" ondragover="allowDrop(event)" class="i18n" data-i18n-id="i18n_taxonomy">Taxonomy</span>
                                    </div>
                                </a>
                            </li>
                            <li><a href="#fh-search_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_search">Search</span></a></li>
                            <li id="fh-favorites_canvas-li"><a href="#fh-favorites_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_favorites">Favorites</span></a></li>
                            <li id="fh-refset_canvas-li"><a href="#fh-refset_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_refset">Refset</span></a></li>
                            <!--<li id="fh-query_canvas-li"><a href="#fh-query_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_constraint">Constraint</span></a></li>-->
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="fh-taxonomy_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-search_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-favorites_canvas" style="padding: 0px;margin: 0;"></div>
                            <div class="tab-pane" id="fh-refset_canvas" style="padding: 0px;margin: 0;"></div>
                            <!--<div class="tab-pane" id="fh-query_canvas" style="padding: 0px;margin: 0;"></div>-->
                        </div>
                    </div>
                    <div class="a panel panel-default" id="fh-tabs-pane2" style="border-radius: 0px;">
                        <ul class="nav nav-tabs" id="fh-tabs2">
                            <li class="active"><a href="#fh-cd1_canvas-pane" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_concept_details">Concept Details</span></a></li>
                            <li id="fh-query_canvas-li"><a href="#fh-query_canvas" data-toggle="tab"><span class="i18n" data-i18n-id="i18n_constraint">Constraint</span></a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="fh-cd1_canvas-pane" style="padding: 0px;margin: 0;">
                                <div class="col-md-12" id="fh-cd1_canvas" style="padding: 0px;margin: 0;"></div>
                            </div>
                            <div class="tab-pane" id="fh-query_canvas" style="padding: 0px;margin: 0;"></div>
                        </div>
                    </div>
                    <!--<div class="" id="conceptDetails-fh">-->
                        <!---->
                    <!--</div>-->
                </div>
            </div>
            <!-- Responsive Perspective -->
            <div id="responsive-perspective" class="bperspective">
                <div id="comparing-taxonomies-wrapper3" class="row" style="width:100%; height: 91%; position: absolute;padding: 0px !important;margin: 0 !important;">
                    <div class="row">
                        <div id="rp-taxonomy_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-cd1_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-search_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                        <div id="rp-cd2_canvas" class="col-sm-6" style="height: 500px;padding: 0px;margin: 0;border: 1px solid gainsboro;"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- License agreement modal -->
        <div class="modal fade" id="license-modal" data-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"><span class="i18n" data-i18n-id="i18n_licence_agreement">SNOMED International SNOMED CT Browser License Agreement</span></h4>
                    </div>
                    <div class="modal-body">
                        <p><span class="i18n" data-i18n-id="i18n_licence_agreement_1">In order to use the SNOMED International SNOMED CT Browser, please accept the following license agreement</span>:</p>
                        <div style="height: 300px; overflow: auto; margin: 20px; border: 1px solid; padding: 10px;">
                            <p><span class="i18n" data-i18n-id="i18n_licence_agreement_2"><strong>SNOMED International SNOMED CT Browser</strong> includes SNOMED Clinical Terms® (SNOMED CT®) which is used by permission of SNOMED International. All rights reserved. SNOMED CT® was originally created by the College of American Pathologists.</span>
                                <span class="i18n" data-i18n-id="i18n_licence_agreement_3">“SNOMED”, “SNOMED CT” and “SNOMED Clinical Terms” are registered trademarks of the SNOMED International (<a href="http://www.snomed.org">www.snomed.org</a>).</span></p>
                            <p><span class="i18n" data-i18n-id="i18n_licence_agreement_4">Use of SNOMED CT in <strong>SNOMED International SNOMED CT Browser</strong> is governed by the conditions of the following SNOMED CT license issued by the SNOMED International</span>:</p>
                            <p style="margin-left: 20px;">1. <span class="i18n" data-i18n-id="i18n_licence_agreement_5">The meaning of the terms “Affiliate”, or “Data Analysis System”, “Data Creation System”, “Derivative”, “End User”, “Extension”, “Member”, “Non-Member Territory”, “SNOMED CT” and “SNOMED CT Content” are as defined in the SNOMED International Affiliate License Agreement (see www.snomed.org/license.pdf)</span>.</p>
                            <p style="margin-left: 20px;">2. <span class="i18n" data-i18n-id="i18n_licence_agreement_6">Information about Affiliate Licensing is available at <a href="http://www.snomed.org/license">www.snomed.org/license</a>. Individuals or organizations wishing to register as SNOMED International Affiliates can register at <a href="https://mlds.ihtsdotools.org">mlds.ihtsdotools.org</a>, subject to acceptance of the Affiliate License Agreement (see <a href="http://www.snomed.org/license.pdf">www.snomed.org/license.pdf)</a></span>.</p>
                            <p style="margin-left: 20px;">3. <span class="i18n" data-i18n-id="i18n_licence_agreement_7">The current list of SNOMED International Member Territories can be viewed at <a href="http://www.snomed.org/members">www.snomed.org/members</a>. Countries not included in that list are “Non-Member Territories”</span>.</p>
                            <p style="margin-left: 20px;">4. <span class="i18n" data-i18n-id="i18n_licence_agreement_8">End Users, that do not hold an SNOMED International Affiliate License, may access SNOMED CT® using <strong>SNOMED International SNOMED CT Browser</strong> subject to acceptance of and adherence to the following sub-license limitations</span>:</p>
                            <p style="margin-left: 40px;">a) <span class="i18n" data-i18n-id="i18n_licence_agreement_9">The sub-licensee is only permitted to access SNOMED CT® using this software (or service) for the purpose of exploring and evaluating the terminology</span>.</p>
                            <p style="margin-left: 40px;">b) <span class="i18n" data-i18n-id="i18n_licence_agreement_10">The sub-licensee is not permitted the use of this software as part of a system that constitutes a SNOMED CT “Data Creation System” or “Data Analysis System”, as defined in the SNOMED International Affiliate License. This means that the sub-licensee must not use <strong>SNOMED International SNOMED CT Browser</strong> to add or copy SNOMED CT identifiers into any type of record system, database or document</span>.</p>
                            <p style="margin-left: 40px;">c) <span class="i18n" data-i18n-id="i18n_licence_agreement_11">The sub-licensee is not permitted to translate or modify SNOMED CT Content or Derivatives</span>.</p>
                            <p style="margin-left: 40px;">d) <span class="i18n" data-i18n-id="i18n_licence_agreement_12">The sub-licensee is not permitted to distribute or share SNOMED CT Content or Derivatives</span>.</p>
                            <p style="margin-left: 20px;">5. <span class="i18n" data-i18n-id="i18n_licence_agreement_13">SNOMED International Affiliates may use <strong>SNOMED International SNOMED CT Browser</strong> as part of a “Data Creation System” or “Data Analysis System” subject to the following conditions</span>:</p>
                            <p style="margin-left: 40px;">a) <span class="i18n" data-i18n-id="i18n_licence_agreement_14">The SNOMED International Affiliate, using <strong>SNOMED International SNOMED CT Browser</strong> must accept full responsibility for any reporting and fees due for use or deployment of such a system in a Non-Member Territory</span>.</p>
                            <p style="margin-left: 40px;">b) <span class="i18n" data-i18n-id="i18n_licence_agreement_15">The SNOMED International Affiliate must not use <strong>SNOMED International SNOMED CT Browser</strong> to access or interact with SNOMED CT in any way that is not permitted by the Affiliate License Agreement</span>.</p>
                            <p style="margin-left: 40px;">c) <span class="i18n" data-i18n-id="i18n_licence_agreement_16">In the event of termination of the Affiliate License Agreement, the use of <strong>SNOMED International SNOMED CT Browser</strong> will be subject to the End User limitations noted in 4</span>.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a href="http://www.snomed.org" class="btn btn-danger"><span class="i18n" data-i18n-id="i18n_reject">Reject</span></a>
                        <button id="accept-license-button-modal" type="button" class="btn btn-success" data-dismiss="modal"><span class="i18n" data-i18n-id="i18n_accept">Accept</span></button>
                        <div class="btn-group dropup pull-left">
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                <span id="nav-selected-flag-modal"></span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('en_US', 'img/flags/us.png', true);"><img src="img/flags/us.png"> English</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('es', 'img/flags/es.png', true);"><img src="img/flags/es.png"> Español</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('da', 'img/flags/dk.png', true);"><img src="img/flags/dk.png"> Dansk</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('pt', 'img/flags/pt.png', true);"><img src="img/flags/pt.png"> Português</a></li>
                                <li class="pull-left"><a href="javascript:void(0);" onclick="switchLanguage('se', 'img/flags/se.png', true);"><img src="img/flags/se.png"> Svenska</a></li>
                            </ul>
                        </div>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->

        <!-- Using Freshdesk Widget for feedback -->
        <script type="text/javascript" src="http://assets.freshdesk.com/widget/freshwidget.js"></script>
        <script type="text/javascript">
                    FreshWidget.init("", {"queryString": "&widgetType=popup&formTitle=SNOMED+CT+Browser+Application+Feedback%2FIssue+Reporting+(Not+for+Content+Issues)&searchArea=no", "backgroundImage": "http://assets.freshdesk.com/widget/help-button.png", "widgetType": "popup", "buttonType": "image", "buttonText": "Support", "buttonColor": "white", "buttonBg": "#00AADD", "alignment": "1", "offset": "-1500px", "formHeight": "500px", "url": "https://ihtsdo.freshdesk.com"});
        </script>

        <script type="text/javascript">
            var $buoop = {};
            $buoop.ol = window.onload;
            window.onload = function () {
                try {
                    if ($buoop.ol)
                        $buoop.ol();
                } catch (e) {
                }
                var e = document.createElement("script");
                e.setAttribute("type", "text/javascript");
                e.setAttribute("src", "//browser-update.org/update.js");
                document.body.appendChild(e);
            }
        </script>
        <!--Start Cookie Script-->
        <script type="text/javascript" charset="UTF-8" src="http://chs02.cookie-script.com/s/b80c8456dc1c3b2bd6652feea1124eb1.js"></script>
        <!--End Cookie Script-->


        <!-- Google Analytics script -->
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-41892858-7', 'ihtsdotools.org');
            ga('send', 'pageview');

        </script>

        <script>
            // History capture of the manual back and forward buttons
            manualStateChange = true;
            History.Adapter.bind(window,'statechange',function(){ // Note: We are using statechange instead of popstate
                if(manualStateChange == true){
                    // BACK BUTTON WAS PRESSED
                    var State = History.getState(); // Note: We are using History.getState() instead of event.state
                    if (State.data && State.data.url) {
                        //console.log("Back button! ", State.data.name);
                        if (State.data.url.indexOf("acceptLicense") == -1) {
                            State.data.url = State.data.url + "&acceptLicense=true";
                        }
                        window.location.href = State.data.url;
                    }
                }
                manualStateChange = true;
            });
        </script>
        <!-- Start of Rocket.Chat Livechat Script
        <script type="text/javascript">
        (function(w, d, s, u) {
        	w.RocketChat = function(c) { w.RocketChat._.push(c) }; w.RocketChat._ = []; w.RocketChat.url = u;
        	var h = d.getElementsByTagName(s)[0], j = d.createElement(s);
        	j.async = true; j.src = 'https://chat.snomedtools.org/packages/rocketchat_livechat/assets/rocketchat-livechat.min.js?_=201702160944';
        	h.parentNode.insertBefore(j, h);
        })(window, document, 'script', 'https://chat.snomedtools.org/livechat');
        </script>
        <!-- End of Rocket.Chat Livechat Script -->
    </body>
</html>
